/*////////////////////////////////////////////////////////////////////////////////////////////////*/
/// <summary>
/// Health.cs
/// </summary>
/*///////////////////////////////////////////////////////////////////////////////////////////////*/
using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class Health : MonoBehaviour
{
    #region PROPERTIES
    [SerializeField] float maxHealth = 10f;
    public float _MaxHealth
    {
        get { return maxHealth; }
        set { maxHealth = value; }
    }
    [SerializeField] float currentHealth = 10f;
    public float _CurrentHealth
    {
        get { return currentHealth; }
        set { UpdateCurrentHealth(value); }
    }    
    #endregion
    #region INITIALIZATION
    /*////////////////////////////////////////////////////////////////////////////////////////////////*/
    /// <summary>
    /// Called when the script is loaded or a value is changed in the
    /// inspector (Called in the editor only).
    /// </summary>
    /*////////////////////////////////////////////////////////////////////////////////////////////////*/
    void OnValidate()
    {
        UpdateCurrentHealth(currentHealth);
    }
    /*////////////////////////////////////////////////////////////////////////////////////////////////*/
    /// <summary>
    /// Awake is called when the script instance is being loaded.
    /// </summary>
    /*////////////////////////////////////////////////////////////////////////////////////////////////*/
    void Awake()
    {
        OnValidate();
        SetSubscriptions();
    }
    /*////////////////////////////////////////////////////////////////////////////////////////////////*/
    /// <summary>
    /// description
    /// </summary>
    /*///////////////////////////////////////////////////////////////////////////////////////////////*/
    void SetSubscriptions()
    {
        Events.instance.AddListener<EVENT_TARGET_UPDATE_HEALTH>(UpdateHealth);
    }
    /*////////////////////////////////////////////////////////////////////////////////////////////////*/
    /// <summary>
    /// description
    /// </summary>
    /*///////////////////////////////////////////////////////////////////////////////////////////////*/
    void RemoveSubscriptions()
    {
        Events.instance.RemoveListener<EVENT_TARGET_UPDATE_HEALTH>(UpdateHealth);
    }    
    #endregion
    #region METHODS
    /*////////////////////////////////////////////////////////////////////////////////////////////////*/
    /// <summary>
    /// description
    /// </summary>
    /*///////////////////////////////////////////////////////////////////////////////////////////////*/
    void UpdateHealth(EVENT_TARGET_UPDATE_HEALTH _event)
    {
        if(_event.target = this.gameObject)
        {
            UpdateCurrentHealth(_event.value);
        }
    }
    /*////////////////////////////////////////////////////////////////////////////////////////////////*/
    /// <summary>
    /// description
    /// </summary>
    /*///////////////////////////////////////////////////////////////////////////////////////////////*/
    void UpdateCurrentHealth(float _value)
    {
        currentHealth += _value;

        if(currentHealth > maxHealth)
        {
            currentHealth = maxHealth;
        }
        else if (currentHealth < 0)
        {
            currentHealth = 0;
            DestroyOwner();
        }
        //Debug.Log("updating health by "+ _value +" to "+ currentHealth);
    }
    /*////////////////////////////////////////////////////////////////////////////////////////////////*/
    /// <summary>
    /// description
    /// </summary>
    /*///////////////////////////////////////////////////////////////////////////////////////////////*/
    void DestroyOwner()
    {
        print("bleh, i have died!");
    }    
    #endregion
    #region ONDESTROY
    /*////////////////////////////////////////////////////////////////////////////////////////////////*/
    /// <summary>
    /// This function is called when the MonoBehaviour will be destroyed.
    /// </summary>
    /*////////////////////////////////////////////////////////////////////////////////////////////////*/
    void OnDestroy()
    {
        RemoveSubscriptions();
    }    
    #endregion
}
